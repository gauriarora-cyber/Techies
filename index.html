<!DOCTYPE html>
<html>
<head>
  <title>BookChain - SwapSafe</title>
  <script src="https://cdn.jsdelivr.net/npm/ethers@5.7.2/dist/ethers.umd.min.js"></script>
</head>
<body>
  <h1>ðŸ“š Welcome to BookChain - SwapSafe</h1>

  <button onclick="connectWallet()">ðŸ”Œ Connect Wallet</button>
  <p id="wallet-address"></p>

  <h2>ðŸ“¤ List a Book</h2>
  <input id="bookTitle" placeholder="Book Title">
  <input id="ipfsHash" placeholder="IPFS Hash">
  <button onclick="listBook()">List Book</button>

  <h2>ðŸ“– Listed Books</h2>
  <ul id="bookList"></ul>

  <script>
    const contractAddress = "0xd9145CCE52D386f254917e481eB44e9943F39138"; // Your Remix-deployed address

    const abi = [
      { "type": "function", "name": "listBook", "inputs": [ { "type": "string" }, { "type": "string" } ], "outputs": [], "stateMutability": "nonpayable" },
      { "type": "function", "name": "bookCount", "inputs": [], "outputs": [ { "type": "uint256" } ], "stateMutability": "view" },
      { "type": "function", "name": "books", "inputs": [ { "type": "uint256" } ], "outputs": [ { "type": "string" }, { "type": "string" }, { "type": "address" } ], "stateMutability": "view" }
    ];

    let signer;
    let contract;

    async function connectWallet() {
      if (typeof window.ethereum !== 'undefined') {
        await ethereum.request({ method: 'eth_requestAccounts' });
        const provider = new ethers.providers.Web3Provider(window.ethereum);
        signer = provider.getSigner();
        const address = await signer.getAddress();
        document.getElementById("wallet-address").innerText = "Connected: " + address;
        contract = new ethers.Contract(contractAddress, abi, signer);
        loadBooks();
      } else {
        alert("Please install MetaMask!");
      }
    }

    async function listBook() {
      const title = document.getElementById("bookTitle").value;
      const ipfs = document.getElementById("ipfsHash").value;
      if (!title || !ipfs) return alert("Fill both fields!");
      try {
        const tx = await contract.listBook(title, ipfs);
        await tx.wait();
        alert("Book listed successfully!");
        loadBooks();
      } catch (err) {
        console.error(err);
        alert("Error listing book!");
      }
    }

    async function loadBooks() {
      if (!contract) return;
      const count = await contract.bookCount();
      const list = document.getElementById("bookList");
      list.innerHTML = "";
      for (let i = 0; i < count; i++) {
        const book = await contract.books(i);
        const li = document.createElement("li");
        li.innerText = `${i + 1}. Title: ${book[0]}, Owner: ${book[2]}`;
        list.appendChild(li);
      }
    }
  </script>
</body>
</html>
